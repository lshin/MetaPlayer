/*
Copyright (c) 2011 RAMP Holdings, Inc.

Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
*/
(function(){window.Ramp={wrap:function(c,f){return function(){c.apply(f||this,arguments)}}};Ramp.Players={};Ramp.Services={};Ramp.Views={};Ramp.UI={};Ramp.Utils={};Ramp.Models={}})();
(function(){var c=jQuery,f={autoLoad:!0,related:!0,loop:!1,dispatcher:null},d=function(a,b){if(!(this instanceof d))return new d(a,b);a instanceof Object&&!(a instanceof Array)&&(b=a,a=null);this.config=c.extend({},f,b);this._tracks=[];this.__index=0;this.__loop=this.config.loop;this.autoLoad=this.config.autoLoad;Ramp.Utils.Proxy.mapProperty("index loop",this);this.dispatcher=this.config.dispatcher||Ramp.Utils.EventDispatcher();this.onPlaylistChange=this.dispatcher.observer("playlistChange");this.onTrackChange=
this.dispatcher.observer("trackChange");this.dispatcher.attach(this);a&&this.add(a)};Ramp.playlist=d;Ramp.Models.Playlist=d;d.prototype={_interface:"empty queue next previous track tracks nextTrack nextTrackIndex onPlaylistChange onTrackChange",attach:function(a){var b=this,e=this._interface.split(/\s+/g);c.each(e,function(e,c){var d=b[c];"_"!=c[0]&&d instanceof Function&&(a[c]=function(){return b[c].apply(b,arguments)})});Ramp.Utils.Proxy.mapProperty("index loop",a,this)},empty:function(){this._tracks=
[];this.index=0;this.dispatcher.dispatch("playlistChange")},queue:function(a){a instanceof Array||(a=[a]);var b=0==this._tracks.length,e=this;c(a).each(function(b,a){e._addTrack(a,!0)});this.dispatcher.dispatch("playlistChange");b&&this.dispatcher.dispatch("trackChange")},_addTrack:function(a){"string"==typeof a&&(a={url:a});this._tracks.push(a)},_index:function(a){if(void 0!=a)this.__index=a%=this._tracks.length,this.dispatcher.dispatch("trackChange");return this.__index},_loop:function(a){if(void 0!==
a)this.__loop=a;return this.__loop},track:function(a){if(void 0===a)a=this.index;return this._tracks[a]},tracks:function(){return this._tracks},nextTrack:function(){return this.track(this.nextTrackIndex())},nextTrackIndex:function(){var a=this.index;if(a+1<this._tracks.length)a++;else if(this.__loop)a=0;else return null;return a},next:function(){var a=this.nextTrackIndex();if(null!==a)this.index=a},previous:function(){var a=this.index;if(0<=a-1)a--;else if(this.__loop)a=this._tracks.length-1;else return;
this.index=a}}})();
(function(){var c=function(f){if(!(this instanceof c))return new c(f);this._listeners={};this._observed={};f&&this.attach(f)};Ramp.Utils.EventDispatcher=c;c.prototype={_interface:"listen forget dispatch addEventListener removeEventListener dispatchEvent",attach:function(c){var d=this._interface.split(/\s+/g),a,b;for(a=0;a<d.length;a++)b=d[a],c[b]=this._wrap(b)},_wrap:function(c){var d=this;return function(){return d[c].apply(d,arguments)}},listen:function(c,d,a,b){this._listeners[c]||(this._listeners[c]=
[]);this._listeners[c].push({fn:d,scope:a,data:b})},forget:function(c,d){var a=this._listeners[c];if(a){var b;for(b=a.length-1;0<=b;b--)(a[b].fn=d)&&a.splice(b,1)}},dispatch:function(c,d,a){var b=this._listeners[c];a||(a={});a.type=c;a.source=this;if(void 0!==d)a.data=d;void 0!==this._observed[c]&&(this._observed[c]=d||!0);if(b)for(c=0;c<b.length;c++)b[c].fn.call(b[c].scope||this,a,b[c].data)},observer:function(c){this._observed[c]=null;var d=this;return function(a,b){var e=function(){a.call(b,d._observed[c])};
d.listen(c,e);null!==d._observed[c]&&setTimeout(e,0)}},addEventListener:function(c,d){this.listen(c,d)},removeEventListener:function(c,d){this.forget(c,d)},dispatchEvent:function(c){if(!(c instanceof Object))throw"invalid event";this.dispatch(c.type,null,c)}}})();(function(){Ramp.Utils.Format={seconds:function(c){var f=function(b,a){for(var c=""+b;c.length<a;)c="0"+c;return c},d=Math.floor(c/3600),a=Math.floor(c%60),c=[f(Math.floor(c%3600/60),2),f(a,2)];d&&c.unshift(d);return c.join(":")}}})();
(function(){var c=jQuery,f={proxyProperty:function(d,a,b){c.each(d.split(/\s+/g),function(e,c){f.mapProperty(c,b,a)})},proxyFunction:function(d,a,b){c.each(d.split(/\s+/g),function(e,c){b[c]=function(){return a[c].apply(a,arguments)}})},proxyEvent:function(d,a,b){c.each(d.split(/\s+/g),function(e,c){f.proxyFunction("on"+c,a,b);a.addEventListener(c,function(a){b.dispatchEvent(a)})})},mapProperty:function(d,a,b){c.each(d.split(/\s+/g),function(e,c){var d;d=!b||b===a?function(){return a["_"+c].apply(a,
arguments)}:function(a){void 0!==a&&(b[c]=a);return b[c]};f.define(a,c,{get:d,set:d})})},define:function(c,a,b){if(Object.defineProperty)return Object.defineProperty(c,a,b);b.get&&c.__defineGetter__(a,options.get);b.set&&c.__defineSetter__(a,options.set)}};Ramp.Utils.Proxy=f})();
(function(){var c=jQuery;Ramp.Utils.Script={url:function(f){var d,a=RegExp(f);c("script").each(function(b,e){var g=c(e).attr("src");if(g&&g.match(a))return d=g,!1});return d},base:function(c){c=this.url(c)||"";return c.substr(0,c.lastIndexOf("/")+1)}}})();
(function(){Ramp.Timer=function(c,f){if(!(this instanceof Ramp.Timer))return new Ramp.Timer(c,f);var d=this;Ramp.Utils.EventDispatcher(this);this.delay=c;this.count=f||-1;this._counted=0;this._onTimeout=function(){d._counted++;d.dispatch("time");0<d.count&&d.count<=d._counted+1&&(d.reset(),d.dispatch("complete"))}};Ramp.Timer.prototype={reset:function(){this._counted=0;this.stop()},stop:function(){clearInterval(this._interval);this._interval=null},start:function(){if(!this._interval)this._interval=
setInterval(this._onTimeout,this.delay)}}})();
(function(){var c=jQuery,f={jsonService:"/{e}.json"},d=function(a,b){if(!(this instanceof d))return new d(a,b);void 0==b&&a instanceof Object&&(b=a,a=null);this.config=c.extend({},f,b);var e=this.config.dispatcher||Ramp.Utils.EventDispatcher();e.attach(this);this.onMetaData=e.observer("metaData");this.onTranscodes=e.observer("transcodes");this.onCaptions=e.observer("captions");this.onTags=e.observer("tags");this.onMetaQ=e.observer("metaQ");this.onRelated=e.observer("related");this.onMediaChange=e.observer("mediaChange");
a&&this.load(a)};Ramp.data=function(a,b){return d(a,b)};d.prototype={_interface:"onMetaData onTranscodes onCaptions onTags onMetaQ onRelated onMediaChange",attach:function(a){var b=this,e=this._interface.split(/\s+/g);c.each(e,function(e,c){var d=b[c];"_"!=c[0]&&d instanceof Function&&(a[c]=function(){return b[c].apply(b,arguments)})})},parse:function(a){return jQuery.parseJSON(a)},load:function(a){"string"==typeof a?a=d.parseUrl(a):a.url&&!a.rampId&&d.parseUrl(a.url,a);if(!a.rampId)throw"invalide media id";
this.mediaId&&this.dispatch("mediaChange");this.mediaId=a.rampId;if(a.rampHost)this.lastHost=a.rampHost;var b=this.lastHost+this.config.jsonService.replace(/{e}/,this.mediaId);c.ajax(b,{dataType:"json",timeout:5E3,context:this,error:function(a,c){console.error("Load  error: "+c+", url: "+b)},success:function(b){this.dispatch("metadata",b.metadata);this.dispatch("related",b.related);this.dispatch("transcodes",b.transcodes);this.dispatch("captions",b.captions);this.dispatch("tags",b.tags);this.dispatch("metaq",
b.metaq)}})},search:function(){throw"not implemented";}};d.parseUrl=function(a,b){var c=a.split(":");void 0==b&&(b={});"ramp"!==c[0]?b.url=a:(b.rampHost=c[1],b.rampId=c[2]);return b}})();
(function(){var c=jQuery,f={playlistService:"/device/services/mp2-playlist?e={e}"},d=function(a,b){if(!(this instanceof d))return new d(a,b);void 0==b&&a instanceof Object&&(b=a,a=null);this.config=c.extend({},f,b);var e=this.config.dispatcher||Ramp.Utils.EventDispatcher();e.attach(this);this.onMetaData=e.observer("metaData");this.onTranscodes=e.observer("transcodes");this.onCaptions=e.observer("captions");this.onTags=e.observer("tags");this.onMetaQ=e.observer("metaQ");this.onRelated=e.observer("related");
this.onMediaChange=e.observer("mediaChange");this.onSearch=e.observer("search");a&&this.load(a)};d.msQuotes=!0;Ramp.data=function(a,b){return d(a,b)};d.parseUrl=function(a,b){var c=a.split(":");void 0==b&&(b={});"ramp"!==c[0]?b.url=a:(b.rampHost=c[1],b.rampId=c[2]);return b};d.prototype={_interface:"onMetaData onTranscodes onCaptions onTags onMetaQ onRelated onMediaChange",attach:function(a){var b=this,e=this._interface.split(/\s+/g);c.each(e,function(c,e){var d=b[e];"_"!=e[0]&&d instanceof Function&&
(a[e]=function(){return b[e].apply(b,arguments)})})},load:function(a){"string"==typeof a?a=d.parseUrl(a):a.url&&!a.rampId&&d.parseUrl(a.url,a);if(!a.rampId)throw"invalide media id";this.mediaId&&this.dispatch("mediaChange");this.mediaId=a.rampId;if(a.rampHost)this.lastHost=a.rampHost;var b=this.lastHost||rampHost,e=b+this.config.playlistService.replace(/{e}/,this.mediaId);c.ajax(e,{dataType:"xml",timeout:5E3,context:this,data:{},error:function(b,a){console.error("Load playlist error: "+a+", url: "+
e)},success:function(a){a=this.parse(a);a.metadata.host=b;this._data=a;this.dispatch("metaData",a.metadata);this.dispatch("related",a.related);this.dispatch("transcodes",a.transcodes);this.dispatch("captions",a.captions);this.dispatch("tags",a.tags);this.dispatch("metaQ",a.metaq)}})},parse:function(a){var b=this,a=c(a).find("par").toArray(),e=this.parseMedia(a.shift());c.each(a,function(a,c){e.related.push(b.parseMedia(c).metadata)});return e},parseMedia:function(a){var b={metadata:{},transcodes:[],
tags:[],captions:[],metaq:{},related:[]},e=c(a).find("video");b.metadata.title=e.attr("title");e.find("metadata meta").each(function(a,e){var d=c(e);b.metadata[d.attr("name")]=d.attr("content")||d.text()});b.transcodes.push({name:"default",type:"video/"+e.attr("type"),url:e.attr("src")});c(a).find("metadata[xml\\:id^=transcodes]").find("meta").each(function(a,e){var h=c(e);b.transcodes.push({name:h.attr("name"),type:h.attr("type")||d.resolveType(h.attr("content")),url:h.attr("content")})});c(a).find("seq[xml\\:id^=jumptags]").find("ref").each(function(a,
e){var d={};c(e).find("param").each(function(b,a){var e=c(a);d[e.attr("name")]=e.text()});if(d.timestamps)d.timestamps=d.timestamps.split(",");b.tags.push(d)});c(a).find("seq[xml\\:id^=metaqs]").find("ref").each(function(a,e){var h={};c(e).find("param").each(function(b,a){var e=c(a),g=e.attr("name"),e=d.deSmart(e.text());"code"==g?(g=c.parseJSON(e),c.extend(!0,h,g)):h[g]=e});b.metaq[h.plugin]||(b.metaq[h.plugin]=[]);b.metaq[h.plugin].push(h)});a=c(a).find("smilText");b.captions=d.parseCaptions(a);
return b},search:function(a,b,e){var g=this._data.metadata.searchapi,g=g.replace(/^(.*\/\/[\w.]+)/,""),f={q:a};a?c.ajax(g,{dataType:"xml",timeout:5E3,context:this,data:f,error:function(b,a){console.error("Load search error: "+a+", url: "+g)},success:function(a){a=d.parseSearch(a);this.dispatch("search",a);b&&b.call(e,a)}}):this.dispatch("search",{query:[],results:[]})}};d.parseSearch=function(a){var a=c(a),b={query:[],results:[]};a.find("SearchTerms Term").each(function(){b.query.push(d.deSmart(c(this).text()))});
a.find("Snippets Snippet").each(function(a,g){var f=c(g),h={start:f.attr("time"),words:[]},f=f.find("T");c.each(f,function(b,a){var e=c(a);h.words.push({match:Boolean(e.find("MQ").length),start:e.attr("s"),text:d.deSmart(e.text())})});b.results.push(h)});return b};d.parseCaptions=function(a){var b=c(a).contents(),e=[],g={text:"",start:0,offset:0},f,h=function(b,a){var h;var i=c(b);h=d.parseSeconds;var k=i.attr("begin");null!=k?h=h(k):(i=i.attr("next"),h=null!=i?h(i)+(void 0).start:void 0);f=g;f.end=
h;a&&(f.text+=a);e.push(f);g={text:"",start:h,offset:g.offset+1}};b.each(function(a,c){var e=b[a].data;if(void 0===c.tagName)d.msQuotes&&(e=d.deSmart(e)),g.text+=e;else switch(c.tagName){case "smil:clear":case "clear":h(c);break;case "smil:tev":case "tev":h(c);break;case "smil:br":case "br":h(c,"<br />");break;default:throw"unsupported tag";}});g.text&&e.push(g);return e};d.parseSeconds=function(a){var b=a.substr(-1),c=parseFloat(a);if("s"==b)return c;if("m"==b)return 60*c;if("h"==b)return 3600*c;
b=0;a=a.split(":");for(c=0;c<Math.min(a.length,4);c++)b+=Math.pow(60,c)*parseFloat(a[c]);return b};d.deSmart=function(a){return a.replace(/\xC2\x92/,"\u2019")};d.resolveType=function(a){a=a.substr(a.lastIndexOf(".")+1);"ogv"==a&&(a="ogg");return"video/"+a}})();
(function(){var c=jQuery,f={applySources:!0,selectSource:!0,preload:!0,muted:!1,autoplay:!1,autoAdvance:!0,related:!0,loop:!1,controls:!0},d=function(a,b,e){if(!(this instanceof d))return new d(a,b,e);this.config=c.extend({},f,e);this._dispatcher=this.config.dispatcher||Ramp.Utils.EventDispatcher();this._dispatcher.attach(this);this._transcodes=[];this._haveRelated=!1;this.service=Ramp.data({dispatcher:this._dispatcher});this.service.attach(this);this.playlist=Ramp.playlist({dispatcher:this._dispatcher,
loop:this.config.loop});this.playlist.attach(this);this._createMarkup(a);this._addMediaProxy();this._addListeners();this._addMediaListeners();b&&this.queue(b)};Ramp.html5=function(a,b,c){return d(a,b,c)};Ramp.metaplayer=Ramp.html5;Ramp.Players.Html5Player=d;d.prototype={load:function(){this.config.applySources&&this._addSources();this.config.selectSource&&this._selectSource();this.config.preload=!0;c(this._video).get(0).load()},_createMarkup:function(a){var b=c('<div class="mp-player"></div>');b.css("position",
"relative");b.css("left","0");b.css("top","0");var e=c(a);e.is("video")?(this._video=a,e.parent().append(b),b.width(e.width()),b.height(e.height()),e.css("width","100%"),e.css("height","100%"),b.append(e)):(b.css("width","100%"),b.css("height","100%"),e.append(b),a=document.createElement("video"),a.autoplay=this.config.autoplay,a.preload=this.config.preload,a.controls=this.config.controls,a.muted=this.config.muted,a.style.width="100%",a.style.height="100%",this._video=a);a=c(this._video);a.css("position",
"absolute");a.css("left","0");a.css("top","0");b.append(a)},_addListeners:function(){this.onTrackChange(this._onTrackChange,this);this.onMetaData(this._onMetaData,this);this.onTranscodes(this._onTranscodes,this);this.onRelated(this._onRelated,this)},_onTrackChange:function(){this.service.load(this.playlist.track())},_onMetaData:function(){},_onRelated:function(a){if(!this._haveRelated&&this.config.related)this.playlist.queue(a),this._haveRelated=!0},_onTranscodes:function(a){this._transcodes=a;this.config.preload&&
this.load()},_addSources:function(){var a=c(this._video);a.find("source").remove();c.each(this._transcodes,function(b,c){var d=document.createElement("source");d.setAttribute("type",c.type);d.setAttribute("src",c.url);a.append(d)})},_selectSource:function(){var a=c(this._video).get(0);c.each(this._transcodes,function(b,c){if(a.canPlayType(c.type))return a.src=c.url,!1})},_addMediaListeners:function(){var a=this;c(this._video).bind("ended",function(){a._onEnded()});c(this._video).bind("playing",function(){a.autoplay=
!0})},_onEnded:function(){if(this.config.autoAdvance)this.autoplay=!0,this.playlist.next()},_addMediaProxy:function(){var a=c(this._video).get(0);Ramp.Utils.Proxy.proxyProperty("duration currentTime volume muted buffered seekable paused played seeking defaultPlaybackRate playbackRate autoplay preload src ended readyState parentNode offsetHeight offsetWidth style className id controls",a,this);Ramp.Utils.Proxy.proxyFunction("play pause getBoundingClientRect getElementsByTagName",a,this);Ramp.Utils.Proxy.proxyEvent("loadstart progress suspend emptied stalled play pause loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange",
a,this)}}})();
(function(){var c=jQuery,f=window.flowplayer,d={autoplay:!1,preload:!0,autoAdvance:!0,related:!0,loop:!1,controls:!0,swfUrl:"flowplayer-3.2.7.swf",wmode:"transparent",fpConfig:{clip:{scaling:"fit"}}},a=function(b,e,g){if(!(this instanceof a))return new a(b,e,g);this.config=c.extend(!0,{},d,g);this.dispatcher=this.config.dispatcher||Ramp.Utils.EventDispatcher();this.dispatcher.attach(this);this.service=Ramp.data({dispatcher:this.dispatcher});this.service.attach(this);this.onPlaylistChange=this.dispatcher.observer("playlistChange");
this.onTrackChange=this.dispatcher.observer("trackChange");this.__seeking=null;this.readyState=0;this.ended=!1;this._loading=!0;this.__playing=!1;Ramp.Utils.Proxy.mapProperty("index loop",this);this._addMediaProxy();this._pageSetup(b);this._addPlayerListeners();this._addServiceListeners();this._addContainerProxy();this.preload=this.config.preload;this.autoplay=this.config.autoplay;this.loop=this.config.loop;this.src=e;this._statepoll=Ramp.Timer(250);this._statepoll.listen("time",this._onPlayStatePoll,
this);this._timeupdater=Ramp.Timer(250);this._timeupdater.listen("time",this._onTimeUpdate,this)};Ramp.flowplayer=function(b,c,d){return a(b,c,d)};Ramp.metaplayer=Ramp.flowplayer;f&&f.addPlugin("ramp",function(b,c){this._ramp=a(this,b,c);return this});a.prototype={load:function(){this.preload=!0;this._flowplayer.isLoaded()&&this._flowplayer.getClip()&&(this.dispatch("loadstart"),this.autoplay?this._flowplayer.play():this._flowplayer.startBuffering())},play:function(){this.__playing=this.autoplay=
!0;this.load()},pause:function(){this._flowplayer.pause()},_pageSetup:function(b){var a=c('<div class="mp-player" style="position:relative;top:0;left:0;width:100%;height:100%"></div>');this.container=a;if(b.getCommonClip)this._flowplayer=b,a.append(b),a=this._flowplayer.getCommonClip(),this.preload=Boolean(a.autoBuffering),this.autoplay=Boolean(a.autoPlay);else{var d=c.extend(!0,{clip:{autoPlay:!1,autoBuffering:!0}},this.config.fpConfig);c(b).append(a);b=c('<div class="mp-video" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div>');
c(a).append(b);this._flowplayer=f(b.get(0),{src:this.config.swfUrl,wmode:this.config.wmode},d)}},_onMetaData:function(){},_onRelated:function(b){if(!this._hasPlaylist&&this.config.related){this._hasPlaylist=!0;var a=this._flowplayer;c.each(b,function(b,c){a.addClip({autoBuffering:!0,autoPlay:!0,title:c.title,description:c.description,thumbnail:c.thumbnail,url:"ramp::"+c.rampId})})}},_onTranscodes:function(b){var a=this._flowplayer.getClip(),d={autoBuffering:!0};c.each(b,function(b,a){if("default"==
a.name)d.url=a.url;if("ios.stream"==a.name)d.iosUrl=a.url});a&&!a.isCommon&&a.update(d);this.autoplay?this.play():this.load()},_addPlayerListeners:function(){var b=this;this._flowplayer.onBeforeLoad(function(){});this._flowplayer.onLoad(function(){b._onLoad()})},_addServiceListeners:function(){this.onTrackChange(this._onTrackChange,this);this.onMetaData(this._onMetaData,this);this.onTranscodes(this._onTranscodes,this);this.onRelated(this._onRelated,this)},_onTrackChange:function(){},_onLoad:function(){var b=
this;this._flowplayer.onVolume(function(){b.dispatch("volumechange")});this._flowplayer.onMute(function(){b.dispatch("volumechange")});this._flowplayer.onUnmute(function(){b.dispatch("volumechange")});this._flowplayer.onError(function(){});this._flowplayer.onPlaylistReplace(function(){b.dispatch("playlistChange")});this._flowplayer.onClipAdd(function(){});this._flowplayer.onBufferFull(function(){});this._flowplayer.onBufferEmpty(function(){});this._flowplayer.onBufferStop(function(){});this._flowplayer.onClipAdd(function(){});
var a=this._flowplayer.getCommonClip();a.onBeforeBegin(function(a){if(a.url&&0==a.url.indexOf("ramp:")){if(!b.preload&&!a.autoBuffering)b.autoplay=!0,b.preload=!0;b.service.load(a.url);return!1}b.dispatch("trackChange");return!0});a.onBegin(function(){b._flowplayer.setVolume(100);b._flowplayer.unmute()});a.onStart(function(){b.autoplay&&(b._setReady(),b._setPlaying(!0));b.dispatch("loadeddata");b.dispatch("loadedmetadata");b.dispatch("durationchange")});a.onStop(function(){});a.onFinish(function(a){b.ended=
!0;b.__seeking=null;b._setPlaying(!1);var c=b._flowplayer.getPlaylist();b.config.autoAdvance?a.index+1==c.length&&(b.dispatch("playlistComplete"),b.loop?b._flowplayer.play(0):b._flowplayer.stop()):b._flowplayer.stop();b.dispatch("ended")});a.onPause(function(){b._setPlaying(!1);b._setReady()});a.onResume(function(){b._setPlaying(!0);b.dispatch("play")});a.onBeforeSeek(function(){b.dispatch("seeking");b.dispatch("timeupdate");if(b.paused)b.dispatch("seeked"),b.__seeking=null});a.onSeek(function(){b.__seeking=
null;b.paused||b.dispatch("seeked")});this.controls=this.config.controls;this.src&&(this._flowplayer.setPlaylist([{url:this.src}]),this.service.load(this.src))},_setReady:function(){4!=this.readyState?(this.readyState=4,this.dispatch("canplay")):(this.dispatch("seeking"),this.dispatch("seeked"))},_setPlaying:function(b){this.__playing=b;this._statepoll.start()},_onPlayStatePoll:function(){if(this._flowplayer.isPlaying()==this.__playing)this._statepoll.reset(),this.__playing?(this.autoplay=!0,this.dispatch("playing"),
this.dispatch("play"),this._timeupdater.start()):(this.dispatch("pause"),this._timeupdater.reset())},_onTimeUpdate:function(){this.dispatch("timeupdate")},_addContainerProxy:function(){c(this.container).get(0);var b=this._flowplayer.getParent();Ramp.Utils.Proxy.proxyProperty("parentNode clientHeight clientWidth offsetHeight clientTop clientLeft scrollTop scrollLeft offsetWidth style className id",b,this);Ramp.Utils.Proxy.proxyFunction("getBoundingClientRect getElementsByTagName",b,this);Ramp.Utils.Proxy.proxyEvent("click mousedown mouseup mouseover mouseoout touchstart touchend touchmove",
b,this)},_addMediaProxy:function(){Ramp.Utils.Proxy.mapProperty("duration currentTime volume muted buffered seeking seekable paused played defaultPlaybackRate playbackRate controls autoplay preload src",this)},_duration:function(){if(!this._flowplayer.isLoaded())return NaN;var b=this._flowplayer.getClip();return b?b.duration:NaN},_currentTime:function(b){if(void 0!==b){0>b&&(b=0);if(b>this.duration)b=this.duration;this.__seeking=b;this._flowplayer.seek(b)}b=this._flowplayer.getStatus();return null!==
this.__seeking?this.__seeking:b.time},_volume:function(b){void 0!==b&&this._flowplayer.setVolume(100*b);return this._flowplayer.getVolume()/100},_muted:function(b){void 0!==b&&(b?this._flowplayer.mute():this._flowplayer.unmute());return this._flowplayer.getStatus().muted},_paused:function(){return!this.__playing},_src:function(b){if(void 0!==b)this.__src=b,this._flowplayer.isLoaded()&&this._flowplayer.setPlaylist([src]);return this.__src},_preload:function(b){if(void 0!==b)this.__preload=b;return this.__preload},
_autoplay:function(b){if(void 0!==b)this.__autoplay=b;return this.__autoplay},_controls:function(b){if(!this._flowplayer.isLoaded()){if(void 0!==b)this.config.controls=b;return this.config.controls}void 0!==b&&(b?this._flowplayer.getControls().show():this._flowplayer.getControls().hide());return 1!=this._flowplayer.getControls().opacity},_seeking:function(){return Boolean(null!==this.__seeking)},_index:function(b){var a=this._flowplayer.getClip();if(!a)return 0;a=a.index;if(void 0!==b){var b=this._resolveIndex(b),
c=this.paused;this._flowplayer.play(b);c&&this._flowplayer.pause()}return a},_resolveIndex:function(a){var c=this._flowplayer.getPlaylist();0>a&&(a=c.length+a);this.loop&&(a%=c.length);return a>=c.length||0>a?void 0:a},_loop:function(a){if(void 0!==a)this.__loop=a;return this.__loop},queue:function(a){this._flowplayer.addClip(a)},clear:function(){this._flowplayer.play([])},next:function(){this.index++},previous:function(){this.index--},nextTrack:function(){return this.track(this.nextTrackIndex())},
nextTrackIndex:function(){return this._resolveIndex(this.index+1)},track:function(a){if(void 0==a)a=this.index;return this._flowplayer.getPlaylist()[this._resolveIndex(a)]},tracks:function(){return this._flowplayer.getPlaylist()},_toMediaRss:function(){}}})();
(function(){var c=jQuery,f=window.Popcorn,d={subtitles:!0},a=function(b,e,g){if(!(this instanceof a))return new a(b,e,g);b.getTrackEvent?this.popcorn=b:b.popcorn?this.popcorn=b.popcorn:(this.popcorn=f(b),b.popcorn=this.popcorn);if(void 0==g&&b.service)g=e,e=b.service;this.config=c.extend(!0,{},d,g);this.player=b;this.service=e;this._sequences={};this.metaq={};this.addDataListeners()};Ramp.metaq=function(b,c){return a(b,c)};a.prototype={addDataListeners:function(){this.service&&(this.service.onMetaData(this.onMetaData,
this),this.service.onCaptions(this._onCaptions,this),this.service.onMetaQ(this._onMetaq,this))},_onCaptions:function(a){this.config.subtitles&&c.extend(this.metaq,{subtitle:a})},_onMetaq:function(a){c.extend(this.metaq,a);this._renderPopcorn()},onMetaData:function(){var a=this.popcorn.getTrackEvents(),e=this;c.each(a,function(a,b){e.popcorn.removeTrackEvent(b._id)});this.metaq={}},_renderPopcorn:function(){var a=this;c.each(this.config,function(e,d){c.each(a.metaq,function(f,h){c.each(h,function(h,
l){if(f==e&&d.clone){var m=d.clone.split(/\s+/);c.each(m,function(d,e){a.metaq[e]||(a.metaq[e]=[]);a.metaq[e].push(c.extend({},l))})}})})});c.each(this.metaq,function(e,d){c.each(d,function(c,f){d[c]=a._composite(e,f)})});c.each(this.metaq,function(d,f){c.each(f,function(c,f){a._schedule(d,f)})})},_composite:function(a,d){var f=this.config[a];if(!f)return d;f.overrides&&(d=c.extend({},d,f.overrides));if(f.duration)d.end=d.start+f.duration;if(f.sequence){var j=this._sequences[f.sequence];if(j)j.end=
d.start;this._sequences[f.sequence]=d}return d},_schedule:function(a,c){var d=this.popcorn[a];d&&d.call(this.popcorn,c)}}})();
