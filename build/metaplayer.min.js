/*
Copyright (c) 2011 RAMP Holdings, Inc.

Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
*/
(function(){window.Ramp={wrap:function(c,f){return function(){c.apply(f||this,arguments)}}};Ramp.Players={};Ramp.Services={};Ramp.Views={};Ramp.UI={};Ramp.Utils={};Ramp.Models={}})();
(function(){var c=jQuery,f={autoLoad:!0,related:!0,loop:!1,dispatcher:null},d=function(a,b){if(!(this instanceof d))return new d(a,b);a instanceof Object&&!(a instanceof Array)&&(b=a,a=null);this.config=c.extend({},f,b);this._tracks=[];this.__index=0;this.__loop=this.config.loop;this.autoLoad=this.config.autoLoad;Ramp.Utils.Proxy.mapProperty("index loop",this);this.dispatcher=this.config.dispatcher||Ramp.Utils.EventDispatcher();this.onPlaylistChange=this.dispatcher.observer("playlistChange");this.onTrackChange=
this.dispatcher.observer("trackChange");this.dispatcher.attach(this);a&&this.add(a)};Ramp.playlist=d;Ramp.Models.Playlist=d;d.prototype={_interface:"empty queue next previous track tracks nextTrack nextTrackIndex onPlaylistChange onTrackChange",attach:function(a){var b=this,e=this._interface.split(/\s+/g);c.each(e,function(e,d){var c=b[d];"_"!=d[0]&&c instanceof Function&&(a[d]=function(){return b[d].apply(b,arguments)})});Ramp.Utils.Proxy.mapProperty("index loop",a,this)},empty:function(){this._tracks=
[];this.index=0;this.dispatcher.dispatch("playlistChange")},queue:function(a){a instanceof Array||(a=[a]);var b=0==this._tracks.length,e=this;c(a).each(function(b,a){e._addTrack(a,!0)});this.dispatcher.dispatch("playlistChange");b&&this.dispatcher.dispatch("trackChange")},_addTrack:function(a){"string"==typeof a&&(a={url:a});this._tracks.push(a)},_index:function(a){if(void 0!=a)this.__index=a%=this._tracks.length,this.dispatcher.dispatch("trackChange");return this.__index},_loop:function(a){if(void 0!==
a)this.__loop=a;return this.__loop},track:function(a){if(void 0===a)a=this.index;return this._tracks[a]},tracks:function(){return this._tracks},nextTrack:function(){return this.track(this.nextTrackIndex())},nextTrackIndex:function(){var a=this.index;if(a+1<this._tracks.length)a++;else if(this.__loop)a=0;else return null;return a},next:function(){var a=this.nextTrackIndex();if(null!==a)this.index=a},previous:function(){var a=this.index;if(0<=a-1)a--;else if(this.__loop)a=this._tracks.length-1;else return;
this.index=a}}})();
(function(){var c=function(f){if(!(this instanceof c))return new c(f);this._listeners={};this._observed={};f&&this.attach(f)};Ramp.Utils.EventDispatcher=c;c.prototype={_interface:"listen forget dispatch addEventListener removeEventListener dispatchEvent",attach:function(c){var d=this._interface.split(/\s+/g),a,b;for(a=0;a<d.length;a++)b=d[a],c[b]=this._wrap(b)},_wrap:function(c){var d=this;return function(){return d[c].apply(d,arguments)}},listen:function(c,d,a,b){this._listeners[c]||(this._listeners[c]=
[]);this._listeners[c].push({fn:d,scope:a,data:b})},forget:function(c,d){var a=this._listeners[c];if(a){var b;for(b=a.length-1;0<=b;b--)(a[b].fn=d)&&a.splice(b,1)}},dispatch:function(c,d,a){var b=this._listeners[c];a||(a={});a.type=c;a.source=this;if(void 0!==d)a.data=d;void 0!==this._observed[c]&&(this._observed[c]=d||!0);if(b)for(c=0;c<b.length;c++)b[c].fn.call(b[c].scope||this,a,b[c].data)},observer:function(c){this._observed[c]=null;var d=this;return function(a,b){var e=function(){a.call(b,d._observed[c])};
d.listen(c,e);null!==d._observed[c]&&setTimeout(e,0)}},addEventListener:function(c,d){this.listen(c,d)},removeEventListener:function(c,d){this.forget(c,d)},dispatchEvent:function(c){if(!(c instanceof Object))throw"invalid event";this.dispatch(c.type,null,c)}}})();(function(){Ramp.Utils.Format={seconds:function(c){var f=function(b,a){for(var c=""+b;c.length<a;)c="0"+c;return c},d=Math.floor(c/3600),a=Math.floor(c%60),c=[f(Math.floor(c%3600/60),2),f(a,2)];d&&c.unshift(d);return c.join(":")}}})();
(function(){var c=jQuery,f={proxyProperty:function(d,a,b){c.each(d.split(/\s+/g),function(e,c){f.mapProperty(c,b,a)})},proxyFunction:function(d,a,b){c.each(d.split(/\s+/g),function(e,c){b[c]=function(){return a[c].apply(a,arguments)}})},proxyEvent:function(d,a,b){b.addEventListener||Ramp.Utils.EventDispatcher().attach(b);c.each(d.split(/\s+/g),function(e,d){c(a).bind(d,function(a){if(b.dispatch)b.dispatch(a.type);else{var e=document.createEvent("Event");e.initEvent(a.type,!1,!1);b.dispatchEvent(e)}})})},
mapProperty:function(d,a,b){b||(b=a);c.each(d.split(/\s+/g),function(e,c){var d=void 0==b[c]?"_"+c:c,h;h=b[d]instanceof Function?function(){return b[d].apply(b,arguments)}:function(a){void 0!==a&&(b[d]=a);return b[d]};f.define(a,c,{get:h,set:h})})},define:function(c,a,b){try{return Object.defineProperty(c,a,b)}catch(e){}c.__defineGetter&&b.get&&c.__defineGetter__(a,b.get);b.set&&c.__defineSetter__&&c.__defineSetter__(a,b.set)}};if(!window.Ramp)window.Ramp={};if(!Ramp.Utils)Ramp.Utils={};Ramp.Utils.Proxy=
f})();(function(){var c=jQuery;Ramp.Utils.Script={url:function(f){var d,a=RegExp(f);c("script").each(function(b,e){var g=c(e).attr("src");if(g&&g.match(a))return d=g,!1});return d},base:function(c){c=this.url(c)||"";return c.substr(0,c.lastIndexOf("/")+1)}}})();
(function(){Ramp.Timer=function(c,f){if(!(this instanceof Ramp.Timer))return new Ramp.Timer(c,f);var d=this;Ramp.Utils.EventDispatcher(this);this.delay=c;this.count=f||-1;this._counted=0;this._onTimeout=function(){d._counted++;d.dispatch("time",{count:d._counted,remain:d.count-d._counted});0<d.count&&d.count<d._counted+1&&(d.reset(),d.dispatch("complete"))}};Ramp.Timer.prototype={reset:function(){this._counted=0;this.stop()},stop:function(){clearInterval(this._interval);this.running=this._interval=
null},toggle:function(){this.running?this.stop():this.start()},start:function(){if(!this._interval)this.running=(new Date).getTime(),this._interval=setInterval(this._onTimeout,this.delay)}}})();
(function(){var c=jQuery;if(!window.Ramp)window.Ramp={};Ramp.UI={ensureOffsetParent:function(f){var f=c(f).first(),d=f[0];if(!(d.offsetParent===d.parentNode&&d.offsetParent.offsetParent)){var a=c("<div></div>");a.css("position","relative");a.css("top",0);a.css("left",0);a.css("width","100%");a.css("height","100%");d.width&&a.width(d.width);d.height&&a.height(d.height);f.css("width","100%");f.css("height","100%");f.parent().append(a);a.append(f)}}}})();
(function(){var c=jQuery,f={jsonService:"/{e}.json"},d=function(a,b){if(!(this instanceof d))return new d(a,b);void 0==b&&a instanceof Object&&(b=a,a=null);this.config=c.extend({},f,b);var e=this.config.dispatcher||Ramp.Utils.EventDispatcher();e.attach(this);this.onMetaData=e.observer("metaData");this.onTranscodes=e.observer("transcodes");this.onCaptions=e.observer("captions");this.onTags=e.observer("tags");this.onMetaQ=e.observer("metaQ");this.onRelated=e.observer("related");this.onMediaChange=e.observer("mediaChange");
a&&this.load(a)};Ramp.data=function(a,b){return d(a,b)};d.prototype={_interface:"onMetaData onTranscodes onCaptions onTags onMetaQ onRelated onMediaChange",attach:function(a){var b=this,e=this._interface.split(/\s+/g);c.each(e,function(e,c){var d=b[c];"_"!=c[0]&&d instanceof Function&&(a[c]=function(){return b[c].apply(b,arguments)})})},parse:function(a){return jQuery.parseJSON(a)},load:function(a){"string"==typeof a?a=d.parseUrl(a):a.url&&!a.rampId&&d.parseUrl(a.url,a);if(!a.rampId)throw"invalide media id";
this.mediaId&&this.dispatch("mediaChange");this.mediaId=a.rampId;if(a.rampHost)this.lastHost=a.rampHost;var b=this.lastHost+this.config.jsonService.replace(/{e}/,this.mediaId);c.ajax(b,{dataType:"json",timeout:5E3,context:this,error:function(a,c){console.error("Load  error: "+c+", url: "+b)},success:function(b){this.dispatch("metadata",b.metadata);this.dispatch("related",b.related);this.dispatch("transcodes",b.transcodes);this.dispatch("captions",b.captions);this.dispatch("tags",b.tags);this.dispatch("metaq",
b.metaq)}})},search:function(){throw"not implemented";}};d.parseUrl=function(a,b){var c=a.split(":");void 0==b&&(b={});"ramp"!==c[0]?b.url=a:(b.rampHost=c[1],b.rampId=c[2]);return b}})();
(function(){var c=jQuery,f={playlistService:"/device/services/mp2-playlist?e={e}"},d=function(a,b){if(!(this instanceof d))return new d(a,b);void 0==b&&a instanceof Object&&(b=a,a=null);this.config=c.extend({},f,b);var e=this.config.dispatcher||Ramp.Utils.EventDispatcher();e.attach(this);this.onMetaData=e.observer("metaData");this.onTranscodes=e.observer("transcodes");this.onCaptions=e.observer("captions");this.onTags=e.observer("tags");this.onMetaQ=e.observer("metaQ");this.onRelated=e.observer("related");
this.onMediaChange=e.observer("mediaChange");this.onSearch=e.observer("search");a&&this.load(a)};d.msQuotes=!0;d.rebase=!0;Ramp.Services.SmilService=d;Ramp.data=function(a,b){return d(a,b)};d.parseUrl=function(a,b){var c=a.split(":");void 0==b&&(b={});"ramp"!==c[0]?b.url=a:(b.rampHost=c[1],b.rampId=c[2]);return b};d.prototype={_interface:"onMetaData onTranscodes onCaptions onTags onMetaQ onRelated onMediaChange",attach:function(a){var b=this,e=this._interface.split(/\s+/g);c.each(e,function(c,e){var d=
b[e];"_"!=e[0]&&d instanceof Function&&(a[e]=function(){return b[e].apply(b,arguments)})})},load:function(a){"string"==typeof a?a=d.parseUrl(a):a.url&&!a.rampId&&d.parseUrl(a.url,a);if(!a.rampId)throw"invalide media id";this.mediaId&&this.dispatch("mediaChange");this.mediaId=a.rampId;if(a.rampHost)this.lastHost=a.rampHost;var b=this.lastHost||rampHost,e=b+this.config.playlistService.replace(/{e}/,this.mediaId);c.ajax(e,{dataType:"xml",timeout:1E4,context:this,data:{},error:function(b,a){console.error("Load playlist error: "+
a+", url: "+e)},success:function(a){a=this.parse(a);a.metadata.host=b;this._data=a;this.dispatch("metaData",a.metadata);this.dispatch("transcodes",a.transcodes);this.dispatch("captions",a.captions);this.dispatch("tags",a.tags);this.dispatch("metaQ",a.metaq);this.dispatch("related",a.related)}})},parse:function(a){var b=this,a=c(a).find("par").toArray(),e=this.parseMedia(a.shift());c.each(a,function(a,c){e.related.push(b.parseMedia(c).metadata)});return e},parseMedia:function(a){var b={metadata:{},
transcodes:[],tags:[],captions:[],metaq:{},related:[]},e=c(a).find("video");b.metadata.title=e.attr("title");e.find("metadata meta").each(function(a,e){var d=c(e);b.metadata[d.attr("name")]=d.attr("content")||d.text()});b.transcodes.push({name:"default",type:"video/"+e.attr("type"),url:e.attr("src")});c(a).find("metadata[xml\\:id^=transcodes]").find("meta").each(function(a,e){var h=c(e);b.transcodes.push({name:h.attr("name"),type:h.attr("type")||d.resolveType(h.attr("content")),url:h.attr("content")})});
c(a).find("seq[xml\\:id^=jumptags]").find("ref").each(function(a,e){var d={};c(e).find("param").each(function(b,a){var e=c(a);d[e.attr("name")]=e.text()});if(d.timestamps)d.timestamps=d.timestamps.split(",");b.tags.push(d)});c(a).find("seq[xml\\:id^=metaqs]").find("ref").each(function(a,e){var f={};c(e).find("param").each(function(b,a){var e=c(a),g=e.attr("name"),e=d.deSmart(e.text());"code"==g?(g=c.parseJSON(e),c.extend(!0,f,g)):f[g]=e});b.metaq[f.plugin]||(b.metaq[f.plugin]=[]);b.metaq[f.plugin].push(f)});
a=c(a).find("smilText");b.captions=d.parseCaptions(a);return b},search:function(a,b,e){var g=this._data.metadata.searchapi;d.rebase&&(g=g.replace(/^(.*\/\/[\w.]+)/,""));var f={q:a};a?c.ajax(g,{dataType:"xml",timeout:1E4,context:this,data:f,error:function(b,a){console.error("Load search error: "+a+", url: "+g)},success:function(a){a=d.parseSearch(a);this.dispatch("search",a);b&&b.call(e,a)}}):(a={query:[],results:[]},this.dispatch("search",a),b.call(e,a))}};d.parseSearch=function(a){var a=c(a),b={query:[],
results:[]};a.find("SearchTerms Term").each(function(){b.query.push(d.deSmart(c(this).text()))});a.find("Snippets Snippet").each(function(a,g){var f=c(g),h={start:f.attr("time"),words:[]},f=f.find("T");c.each(f,function(b,a){var e=c(a);h.words.push({match:Boolean(e.find("MQ").length),start:e.attr("s"),text:d.deSmart(e.text())})});b.results.push(h)});return b};d.parseCaptions=function(a){var b=c(a).contents(),e=[],g={text:"",start:0,offset:0},f,h=function(b,a){var h;var i=c(b);h=d.parseSeconds;var j=
i.attr("begin");null!=j?h=h(j):(i=i.attr("next"),h=null!=i?h(i)+(void 0).start:void 0);f=g;f.end=h;a&&(f.text+=a);e.push(f);g={text:"",start:h,offset:g.offset+1}};b.each(function(a,c){var e=b[a].data;if(void 0===c.tagName)d.msQuotes&&(e=d.deSmart(e)),g.text+=e;else switch(c.tagName){case "smil:clear":case "clear":h(c);break;case "smil:tev":case "tev":h(c);break;case "smil:br":case "br":h(c,"<br />");break;default:throw"unsupported tag";}});g.text&&e.push(g);return e};d.parseSeconds=function(a){var b=
a.substr(-1),c=parseFloat(a);if("s"==b)return c;if("m"==b)return 60*c;if("h"==b)return 3600*c;b=0;a=a.split(":");for(c=0;c<Math.min(a.length,4);c++)b+=Math.pow(60,c)*parseFloat(a[c]);return b};d.deSmart=function(a){return a.replace(/\xC2\x92/,"\u2019")};d.resolveType=function(a){a=a.substr(a.lastIndexOf(".")+1);"ogv"==a&&(a="ogg");return"video/"+a}})();
(function(){var c=jQuery,f={applySources:!0,selectSource:!0,preload:!0,muted:!1,autoplay:!1,autoAdvance:!0,related:!0,loop:!1,controls:!0},d=function(a,b,e){if(!(this instanceof d))return new d(a,b,e);this.config=c.extend({},f,e);this._dispatcher=this.config.dispatcher||Ramp.Utils.EventDispatcher();this._dispatcher.attach(this);this._transcodes=[];this._haveRelated=!1;this.advance=this.config.autoAdvance;this.service=Ramp.data({dispatcher:this._dispatcher});this.service.attach(this);this.playlist=
Ramp.playlist({dispatcher:this._dispatcher,loop:this.config.loop});this.playlist.attach(this);this._createMarkup(a);this._addListeners();this._addMediaListeners();b&&this.playlist.queue(b)};Ramp.html5=function(a,b,c){a=d(a,b,c);a.video._player=a;return a.video};Ramp.metaplayer=Ramp.html5;Ramp.Players.Html5Player=d;d.prototype={load:function(){this.config.applySources&&this._addSources();this.config.selectSource&&this._selectSource();this.config.preload=!0;this.video.load()},decorate:function(a){var b=
Ramp.Utils.Proxy.mapProperty,c=Ramp.Utils.Proxy.proxyFunction;b("index service",a,this);c("next previous track tracks",this,a)},_createMarkup:function(a){a=c(a);if(a.is("video"))this.video=a.get(0);else{var b=document.createElement("video");b.autoplay=this.config.autoplay;b.preload=this.config.preload;b.controls=this.config.controls;b.muted=this.config.muted;b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.width="100%";b.style.height="100%";this.video=b;a.append(b)}this.decorate(this.video);
Ramp.UI.ensureOffsetParent(this.video)},_addListeners:function(){this.onTrackChange(this._onTrackChange,this);this.onMetaData(this._onMetaData,this);this.onTranscodes(this._onTranscodes,this);this.onRelated(this._onRelated,this)},_onTrackChange:function(){this.service.load(this.playlist.track())},_onMetaData:function(a){c.extend(this.track(),a)},_onRelated:function(a){if(!this._haveRelated&&this.config.related)this.playlist.queue(a),this._haveRelated=!0},_onTranscodes:function(a){this._transcodes=
a;this.config.preload&&this.load()},_children:function(){if(this.video.children.length)return this.video.children;var a=this.track(),b=document.createElement("source");b.setAttribute("type","video/ramp");b.setAttribute("src",a.url);return[b]},canPlayType:function(a){return"video/ramp"==a?"probably":this.video.canPlayType(a)},_src:function(a){void 0!==a&&(this.playlist.clear(),this.playlist.queue(a));return this.track().src},_addSources:function(){var a=c(this.video);a.find("source").remove();c.each(this._transcodes,
function(b,c){var d=document.createElement("source");d.setAttribute("type",c.type);d.setAttribute("src",c.url);a.append(d)})},_selectSource:function(){var a=this.video;c.each(this._transcodes,function(b,c){if(a.canPlayType(c.type))return a.src=c.url,!1})},_addMediaListeners:function(){var a=this;c(this.video).bind("ended",function(){a._onEnded()});c(this.video).bind("playing",function(){a.autoplay=!0})},_onEnded:function(){if(this.advance)this.autoplay=!0,this.playlist.next()},decorate:function(){Ramp.Utils.Proxy.mapProperty("index advance service",
this.video,this);Ramp.Utils.Proxy.proxyFunction("next previous track tracks queue clear nextTrack nextTrackIndex onPlaylistChange onTrackChange",this,this.video);Ramp.Utils.Proxy.proxyEvent("trackChange playlistChange ",this,this.video)}}})();
(function(){var c=jQuery,f=window.flowplayer,d={autoplay:!1,preload:!0,advance:!0,related:!0,loop:!1,controls:!0,swfUrl:"flowplayer-3.2.7.swf",wmode:"transparent",statusThrottleMSec:500,fpConfig:{clip:{scaling:"fit"}}},a=function(b,e,g){if(!(this instanceof a))return new a(b,e,g);this.config=c.extend(!0,{},d,g);this.dispatcher=this.config.dispatcher||Ramp.Utils.EventDispatcher();this.dispatcher.attach(this);this.service=Ramp.data({dispatcher:this.dispatcher});this.service.attach(this);this.onPlaylistChange=
this.dispatcher.observer("playlistChange");this.onTrackChange=this.dispatcher.observer("trackChange");this.__seeking=null;this.__readyState=0;this.__ended=!1;this.__paused=!0;this._pageSetup(b);this._addServiceListeners();this.__preload=this.config.preload;this.__autoplay=this.config.autoplay;this.__loop=this.config.loop;this.__advance=this.config.advance;this.__src=e;this._statepoll=Ramp.Timer(250);this._statepoll.listen("time",this._onPlayStatePoll,this);this._timeupdater=Ramp.Timer(250);this._timeupdater.listen("time",
this._onTimeUpdate,this);var f=this;this._flowplayer.onLoad(function(){f._onLoad()})};Ramp.flowplayer=function(b,c,d){b=a(b,c,d);b.video._player=b;return b.video};a.prototype={_pageSetup:function(b){if(b.getCommonClip)this._flowplayer=b,b=this._flowplayer.getCommonClip(),this.preload(Boolean(b.autoBuffering)),this.autoplay(Boolean(b.autoPlay));else{var a=c.extend(!0,{clip:{autoPlay:!1,autoBuffering:!0}},this.config.fpConfig),d=c('<div class="mp-video""></div>');c(b).append(d);this._flowplayer=f(d.get(0),
{src:this.config.swfUrl,wmode:this.config.wmode},a)}this.video=this._flowplayer.getParent();this.decorate(this.video);Ramp.UI.ensureOffsetParent(this.video)},_addServiceListeners:function(){this.service.onMetaData(this._onMetaData,this);this.service.onTranscodes(this._onTranscodes,this);this.service.onRelated(this._onRelated,this)},_onMetaData:function(b){this._metadata=b},_onRelated:function(b){if(!this._hasPlaylist&&this.config.related){this._hasPlaylist=!0;var a=this._flowplayer;c.each(b,function(b,
c){a.addClip({autoBuffering:!0,autoPlay:!0,title:c.title,description:c.description,thumbnail:c.thumbnail,url:"ramp::"+c.rampId})})}},_onTranscodes:function(b){var a={autoBuffering:!0,url:this.src(),title:this._metadata.title,description:this._metadata.description,thumbnail:this._metadata.thumbnail};c.each(b,function(b,c){if("default"==c.name)a.url=c.url;if("ios.stream"==c.name)a.iosUrl=c.url});(b=this._flowplayer.getClip())?b.update(a):this._flowplayer.setPlaylist([a]);this.autoplay()?this.play():
this.preload()&&this.load()},_onLoad:function(){var b=this;this._flowplayer.onVolume(function(){b.dispatch("volumechange")});this._flowplayer.onMute(function(){b.dispatch("volumechange")});this._flowplayer.onUnmute(function(){b.dispatch("volumechange")});this._flowplayer.onPlaylistReplace(function(){b.dispatch("playlistChange")});this._flowplayer.onClipAdd(function(){b.dispatch("playlistChange")});var a=this._flowplayer.getCommonClip();a.onBeforeBegin(function(a){if(a.url&&0==a.url.indexOf("ramp:"))return!b.preload()&&
!a.autoBuffering&&(b.autoplay(!0),b.preload(!0)),b.service.load(a.url),!1;if(!a.url&&this.src())return!1;b.dispatch("trackChange");b.dispatch("loadstart");return!0});a.onBegin(function(){b._flowplayer.setVolume(100);b._flowplayer.unmute()});a.onStart(function(a){b._setReady();b._setPlaying(!0);b.dispatch("loadeddata");b.__duration=a.duration;b.dispatch("durationchange");b.dispatch("loadedmetadata")});a.onStop(function(){});a.onFinish(function(a){b.__ended=!0;b.__seeking=null;b._setPlaying(!1);var c=
b._flowplayer.getPlaylist();b.advance()?a.index+1==c.length&&(b.dispatch("playlistComplete"),b.loop()?b._flowplayer.play(0):b._flowplayer.stop()):b._flowplayer.stop();b.dispatch("ended");b._flowplayer.play(a.index+1)});a.onPause(function(){b._setPlaying(!1);b._setReady()});a.onResume(function(){b._setPlaying(!0);b.dispatch("play")});a.onBeforeSeek(function(){b.dispatch("seeking");b.dispatch("timeupdate");if(b.paused())b.dispatch("seeked"),b.__seeking=null});a.onSeek(function(){b.__seeking=null;b.paused()||
b.dispatch("seeked")});this.controls(this.config.controls);this.src()&&this.service.load(this.src())},_setReady:function(){4!=this.__readyState?(this.__readyState=4,this.dispatch("canplay")):(this.dispatch("seeking"),this.dispatch("seeked"))},_setPlaying:function(b){this.__paused=!b;this._statepoll.start()},load:function(){this.preload(!0);this._flowplayer.isLoaded()&&(this.autoplay()?this._flowplayer.play():this._flowplayer.startBuffering())},play:function(){this.autoplay(!0);this.__paused=!1;this.load()},
pause:function(){this._flowplayer.pause()},canPlayType:function(){return"probably"},paused:function(){return this.__paused},duration:function(){return this.__duration},seeking:function(){return null!==this.__seeking},ended:function(){return this.__ended},currentTime:function(b){if(void 0!==b){0>b&&(b=0);if(b>this.duration)b=this.duration;this.__seeking=b;this._flowplayer.seek(b)}if(null!==this.__seeking)return this.__seeking;var b=(new Date).getTime(),a=this.__currentTimeCache,c=b-a;if(a&&c<this.config.statusThrottleMSec)return this.__currentTime+
c/1E3;this.__currentTimeCache=b;return this.__currentTime=this._flowplayer.getStatus().time},muted:function(b){void 0!==b&&(b?this._flowplayer.mute():this._flowplayer.unmute());return this._flowplayer.getStatus().muted},volume:function(b){void 0!==b&&this._flowplayer.setVolume(100*b);return this._flowplayer.getVolume()/100},controls:function(b){if(!this._flowplayer.isLoaded()){if(void 0!==b)this.config.controls=b;return this.config.controls}void 0!==b&&(b?(this._flowplayer.getControls().show(),this._flowplayer.getPlugin("play").show()):
(this._flowplayer.getControls().hide(),this._flowplayer.getPlugin("play").hide()));return 1!=this._flowplayer.getControls().opacity},preload:function(b){if(void 0!==b)this.__preload=b;return this.__preload},autoplay:function(b){if(void 0!==b)this.__autoplay=b;return this.__autoplay},loop:function(b){if(void 0!==b)this.__loop=b;return this.__loop},src:function(b){if(void 0!==b)this.__src=b,this._flowplayer.isLoaded()&&this._flowplayer.setPlaylist([src]);return this.__src},readyState:function(b){if(void 0!==
b)this.__readyState=b;return this.__readyState},_children:function(){var b=document.createElement("source");b.setAttribute("type","video/ramp");b.setAttribute("src",this.src);return[b]},index:function(b){var a=this._flowplayer.getClip();if(!a)return 0;if(void 0==b)return a.index;a=this.paused();b=this._resolveIndex(b);this._flowplayer.play(b);a&&this._flowplayer.pause();return b},_resolveIndex:function(b){var a=this._flowplayer.getPlaylist();0>b&&(b=a.length+b);this.loop()&&(b%=a.length);return b>=
a.length||0>b?void 0:b},advance:function(b){if(void 0!==b)this.__advance=b;return this.__advance},queue:function(b){this._flowplayer.addClip(b)},clear:function(){this._flowplayer.play([])},next:function(){this.index(this.index()+1)},previous:function(){this.index(this.index()-1)},nextTrack:function(){return this.track(this.nextTrackIndex())},nextTrackIndex:function(){return this._resolveIndex(this.index()+1)},track:function(b){void 0==b&&(b=this.index());return this._flowplayer.getPlaylist()[this._resolveIndex(b)]},
tracks:function(){return this._flowplayer.getPlaylist()},decorate:function(){Ramp.Utils.Proxy.mapProperty("duration currentTime volume muted seeking seekable paused played controls autoplay preload src ended index advance readyState children service",this.video,this);Ramp.Utils.Proxy.proxyFunction("load play pause canPlayType next previous track tracks queue clear nextTrack nextTrackIndex onPlaylistChange onTrackChange",this,this.video);Ramp.Utils.Proxy.proxyEvent("timeupdate seeking seeked playing play pause loadeddata loadedmetadata canplay loadstart durationchange volumechange ended trackChange playlistChange ",
this,this.video)},_onPlayStatePoll:function(){this._flowplayer.isPlaying()!==this.paused()&&(this._statepoll.reset(),this.paused()?(this.dispatch("pause"),this._timeupdater.reset()):(this.autoplay(!0),this.dispatch("playing"),this.dispatch("play"),this._timeupdater.start()))},_onTimeUpdate:function(){this.dispatch("timeupdate")}}})();
(function(){var c=jQuery,f=window.Popcorn,d={subtitles:!0},a=function(b,e,g){if(!(this instanceof a))return new a(b,e,g);if(window.Popcorn&&f instanceof Function){b.getTrackEvent?this.popcorn=b:b.popcorn?this.popcorn=b.popcorn:(this.popcorn=f(b),b.popcorn=this.popcorn);if(void 0==g&&b.service)g=e,e=b.service;this.config=c.extend(!0,{},d,g);this.player=b;this.service=e;this._sequences={};this.metaq={};this.addDataListeners()}};Ramp.metaq=function(b,c){return a(b,c)};a.prototype={addDataListeners:function(){this.service&&
(this.service.onMetaData(this.onMetaData,this),this.service.onCaptions(this._onCaptions,this),this.service.onMetaQ(this._onMetaq,this))},_onCaptions:function(b){this.config.subtitles&&c.extend(this.metaq,{subtitle:b})},_onMetaq:function(b){c.extend(this.metaq,b);this._renderPopcorn()},onMetaData:function(){var b=this.popcorn.getTrackEvents(),a=this;c.each(b,function(b,c){a.popcorn.removeTrackEvent(c._id)});this.metaq={}},_renderPopcorn:function(){var b=this;c.each(this.config,function(a,d){c.each(b.metaq,
function(f,h){c.each(h,function(h,k){if(f==a&&d.clone){var l=d.clone.split(/\s+/);c.each(l,function(a,d){b.metaq[d]||(b.metaq[d]=[]);b.metaq[d].push(c.extend({},k))})}})})});c.each(this.metaq,function(a,d){c.each(d,function(c,f){d[c]=b._composite(a,f)})});c.each(this.metaq,function(a,d){c.each(d,function(c,d){b._schedule(a,d)})})},_composite:function(b,a){var d=this.config[b];if(!d)return a;d.overrides&&(a=c.extend({},a,d.overrides));if(d.duration)a.end=a.start+d.duration;if(d.sequence){var f=this._sequences[d.sequence];
if(f)f.end=a.start;this._sequences[d.sequence]=a}return a},_schedule:function(a,c){var d=this.popcorn[a];d&&d.call(this.popcorn,c)}}})();
